<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ç†ç¢°æ’è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .debug-panel h3 {
            margin-top: 0;
            color: #333;
        }
        .debug-button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .debug-button:hover {
            background: #0056b3;
        }
        .status {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .instructions {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .instructions h2 {
            color: #333;
            margin-top: 0;
        }
        .instructions ol {
            padding-left: 20px;
        }
        .instructions li {
            margin: 8px 0;
        }
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="instructions">
        <h2>ğŸ”§ ç‰©ç†ç¢°æ’è°ƒè¯•æŒ‡å—</h2>
        <p>è¿™ä¸ªé¡µé¢å¸®åŠ©ä½ è°ƒè¯• SchoolBuilding.ts å’Œ Model.ts ä¹‹é—´çš„ç‰©ç†ç¢°æ’é—®é¢˜ã€‚</p>
        
        <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤ï¼š</h3>
        <ol>
            <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å° (F12)</li>
            <li>è®¿é—®ä¸»åº”ç”¨é¡µé¢: <a href="/index.html" target="_blank">æ‰“å¼€ä¸»åº”ç”¨</a></li>
            <li>ç­‰å¾…æ¨¡å‹åŠ è½½å®Œæˆ</li>
            <li>åœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹ç‰©ç†ä½“åˆ›å»ºæ—¥å¿—</li>
            <li>ä½¿ç”¨å³ä¾§è°ƒè¯•é¢æ¿ä¸­çš„æŒ‰é’®è¿›è¡Œæµ‹è¯•</li>
            <li>ä½¿ç”¨ WASD é”®ç§»åŠ¨äººç‰©ï¼Œæµ‹è¯•ç¢°æ’æ•ˆæœ</li>
        </ol>

        <h3>ğŸ” é¢„æœŸçš„æ§åˆ¶å°è¾“å‡ºï¼š</h3>
        <div class="console-output">
ğŸ« SchoolBuilding æ„é€ å‡½æ•°è°ƒç”¨å®Œæˆ
ğŸ” ç‰©ç†ä¸–ç•ŒçŠ¶æ€: âœ… å·²ä¼ é€’
ğŸ« å¼€å§‹åˆ›å»ºå­¦æ ¡å»ºç­‘...
ğŸ“ å¼€å§‹åŠ è½½å­¦æ ¡å»ºç­‘æ¨¡å‹æ–‡ä»¶...
âœ… å­¦æ ¡å»ºç­‘æ¨¡å‹æ–‡ä»¶åŠ è½½æˆåŠŸ
ğŸ” å¼€å§‹æå–å­¦æ ¡å»ºç­‘æ¨¡å‹...
âœ… å­¦æ ¡å»ºç­‘æ¨¡å‹åŠ è½½å®Œæˆ
ğŸ« å­¦æ ¡å»ºç­‘æ¨¡å‹åŠ è½½å®Œæˆï¼Œå‡†å¤‡åˆ›å»ºç‰©ç†ä½“...
â° å¼€å§‹åˆ›å»ºå­¦æ ¡å»ºç­‘ç‰©ç†ä½“...
ğŸ”§ å¼€å§‹åˆ›å»ºå­¦æ ¡å»ºç­‘CANNONç²¾ç¡®ç‰©ç†ä½“...
âœ… CANNONç‰©ç†ä½“å·²åˆ›å»ºå¹¶æ·»åŠ åˆ°ç‰©ç†ä¸–ç•Œ
âœ… å­¦æ ¡å»ºç­‘ç‰©ç†ä½“éªŒè¯æˆåŠŸï¼Œå¯ä»¥ä¸äººç‰©è¿›è¡Œç¢°æ’æ£€æµ‹
âœ… äººç‰©ç‰©ç†ä½“éªŒè¯æˆåŠŸï¼Œå¯ä»¥ä¸å»ºç­‘ç‰©è¿›è¡Œç¢°æ’æ£€æµ‹
        </div>

        <h3>âš ï¸ å¸¸è§é—®é¢˜ï¼š</h3>
        <ul>
            <li><strong>ç‰©ç†ä¸–ç•ŒçŠ¶æ€: âŒ æœªä¼ é€’</strong> - æ£€æŸ¥ ObjectManager ä¸­çš„ç‰©ç†ä¸–ç•Œä¼ é€’</li>
            <li><strong>å»ºç­‘å¯¹è±¡ç¼ºå¤±</strong> - æ£€æŸ¥æ¨¡å‹æ–‡ä»¶è·¯å¾„å’ŒåŠ è½½çŠ¶æ€</li>
            <li><strong>ç‰©ç†ä½“éªŒè¯å¤±è´¥</strong> - æ£€æŸ¥ç‰©ç†ä½“åˆ›å»ºæ—¶åºå’Œå‚æ•°</li>
            <li><strong>æ²¡æœ‰ç¢°æ’æ•ˆæœ</strong> - æ£€æŸ¥æè´¨å…¼å®¹æ€§å’Œç‰©ç†å¼•æ“æ›´æ–°</li>
        </ul>
    </div>

    <div class="debug-panel">
        <h3>ğŸ› ï¸ è°ƒè¯•å·¥å…·</h3>
        
        <button class="debug-button" onclick="checkPhysicsWorld()">
            æ£€æŸ¥ç‰©ç†ä¸–ç•ŒçŠ¶æ€
        </button>
        
        <button class="debug-button" onclick="checkBuildingPhysics()">
            æ£€æŸ¥å»ºç­‘ç‰©ç†ä½“
        </button>
        
        <button class="debug-button" onclick="checkPlayerPhysics()">
            æ£€æŸ¥äººç‰©ç‰©ç†ä½“
        </button>
        
        <button class="debug-button" onclick="toggleVisualization()">
            åˆ‡æ¢å¯è§†åŒ–è¾…åŠ©çº¿
        </button>
        
        <button class="debug-button" onclick="testCollision()">
            æµ‹è¯•ç¢°æ’æ£€æµ‹
        </button>
        
        <div id="status-container">
            <!-- çŠ¶æ€ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>

    <script>
        function showStatus(message, type = 'info') {
            const container = document.getElementById('status-container');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            container.appendChild(statusDiv);
            
            // 5ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.parentNode.removeChild(statusDiv);
                }
            }, 5000);
        }

        function checkPhysicsWorld() {
            console.log('ğŸ” æ£€æŸ¥ç‰©ç†ä¸–ç•ŒçŠ¶æ€...');
            showStatus('æ£€æŸ¥ç‰©ç†ä¸–ç•ŒçŠ¶æ€ - æŸ¥çœ‹æ§åˆ¶å°', 'warning');
            
            // è¿™äº›å‡½æ•°éœ€è¦åœ¨ä¸»åº”ç”¨çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ
            if (window.physicsManager) {
                window.physicsManager.showPhysicsInfo();
                window.physicsManager.checkCollisionDetection();
                showStatus('ç‰©ç†ä¸–ç•Œæ£€æŸ¥å®Œæˆ', 'success');
            } else {
                showStatus('ç‰©ç†ç®¡ç†å™¨æœªæ‰¾åˆ° - è¯·å…ˆæ‰“å¼€ä¸»åº”ç”¨', 'error');
            }
        }

        function checkBuildingPhysics() {
            console.log('ğŸ« æ£€æŸ¥å»ºç­‘ç‰©ç†ä½“...');
            showStatus('æ£€æŸ¥å»ºç­‘ç‰©ç†ä½“ - æŸ¥çœ‹æ§åˆ¶å°', 'warning');
            
            if (window.objectManager) {
                const building = window.objectManager.getObject('school-building');
                if (building && building.validatePhysicsBodyInWorld) {
                    const isValid = building.validatePhysicsBodyInWorld();
                    const info = building.getPhysicsBodyInfo();
                    console.log('ğŸ« å»ºç­‘ç‰©ç†ä½“ä¿¡æ¯:', info);
                    showStatus(isValid ? 'å»ºç­‘ç‰©ç†ä½“æ­£å¸¸' : 'å»ºç­‘ç‰©ç†ä½“å¼‚å¸¸', isValid ? 'success' : 'error');
                } else {
                    showStatus('å»ºç­‘å¯¹è±¡æœªæ‰¾åˆ°', 'error');
                }
            } else {
                showStatus('å¯¹è±¡ç®¡ç†å™¨æœªæ‰¾åˆ° - è¯·å…ˆæ‰“å¼€ä¸»åº”ç”¨', 'error');
            }
        }

        function checkPlayerPhysics() {
            console.log('ğŸ‘¤ æ£€æŸ¥äººç‰©ç‰©ç†ä½“...');
            showStatus('æ£€æŸ¥äººç‰©ç‰©ç†ä½“ - æŸ¥çœ‹æ§åˆ¶å°', 'warning');
            
            if (window.mmdModelManager) {
                const model = window.mmdModelManager.getModel();
                if (model && model.validatePhysicsBodyInWorld) {
                    const isValid = model.validatePhysicsBodyInWorld();
                    const info = model.getPhysicsBodyInfo();
                    console.log('ğŸ‘¤ äººç‰©ç‰©ç†ä½“ä¿¡æ¯:', info);
                    showStatus(isValid ? 'äººç‰©ç‰©ç†ä½“æ­£å¸¸' : 'äººç‰©ç‰©ç†ä½“å¼‚å¸¸', isValid ? 'success' : 'error');
                } else {
                    showStatus('äººç‰©æ¨¡å‹æœªæ‰¾åˆ°', 'error');
                }
            } else {
                showStatus('æ¨¡å‹ç®¡ç†å™¨æœªæ‰¾åˆ° - è¯·å…ˆæ‰“å¼€ä¸»åº”ç”¨', 'error');
            }
        }

        function toggleVisualization() {
            console.log('ğŸ‘ï¸ åˆ‡æ¢å¯è§†åŒ–è¾…åŠ©çº¿...');
            showStatus('åˆ‡æ¢å¯è§†åŒ–è¾…åŠ©çº¿', 'warning');
            
            if (window.objectManager) {
                const building = window.objectManager.getObject('school-building');
                if (building) {
                    // åˆ‡æ¢å„ç§å¯è§†åŒ–
                    if (building.setBVHVisualizationVisible) {
                        building.setBVHVisualizationVisible(true);
                    }
                    if (building.setColliderVisible) {
                        building.setColliderVisible(true);
                    }
                    if (building.setPhysicsVisualizationVisible) {
                        building.setPhysicsVisualizationVisible(true);
                    }
                    showStatus('å¯è§†åŒ–è¾…åŠ©çº¿å·²å¼€å¯', 'success');
                } else {
                    showStatus('å»ºç­‘å¯¹è±¡æœªæ‰¾åˆ°', 'error');
                }
            } else {
                showStatus('å¯¹è±¡ç®¡ç†å™¨æœªæ‰¾åˆ° - è¯·å…ˆæ‰“å¼€ä¸»åº”ç”¨', 'error');
            }
        }

        function testCollision() {
            console.log('ğŸ¯ æµ‹è¯•ç¢°æ’æ£€æµ‹...');
            showStatus('æµ‹è¯•ç¢°æ’æ£€æµ‹ - è¯·ä½¿ç”¨WASDç§»åŠ¨äººç‰©', 'warning');
            
            // æç¤ºç”¨æˆ·å¦‚ä½•æµ‹è¯•
            alert('è¯·ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æµ‹è¯•ç¢°æ’ï¼š\n\n1. ä½¿ç”¨ WASD é”®ç§»åŠ¨äººç‰©\n2. å°è¯•è®©äººç‰©æ¥è¿‘å»ºç­‘ç‰©\n3. è§‚å¯Ÿæ§åˆ¶å°çš„ç¢°æ’äº‹ä»¶æ—¥å¿—\n4. æ£€æŸ¥äººç‰©æ˜¯å¦èƒ½ç©¿é€å»ºç­‘ç‰©');
        }

        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        window.addEventListener('load', () => {
            showStatus('è°ƒè¯•é¡µé¢å·²åŠ è½½ - è¯·å…ˆæ‰“å¼€ä¸»åº”ç”¨', 'warning');
        });
    </script>
</body>
</html>
